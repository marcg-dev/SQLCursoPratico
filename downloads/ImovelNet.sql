-- Author: Marcelo Gomes
-- Email: marcs.rgo@gmail.com
-- This file represents the answer to the exercises, in: Chapter 4: 1, 2, 3 and Chapter 5: 1, 2, 3, 4, 5, 6, 7, 15.

-- EXERCISE 1 OF THE CHAPTER 4
CREATE TABLE ESTADO (
    SGESTADO CHAR(2) NOT NULL,
    NMESTADO VARCHAR(20) NOT NULL,
    PRIMARY KEY (SGESTADO)
);

-- EXERCISE 1 OF THE CHAPTER 5
INSERT INTO ESTADO (SGESTADO, NMESTADO)
    VALUES('SP', 'RIO DE JANEIRO'),
    ('RJ', 'RIO DE JANEIRO');

-- EXERCISE 1 OF THE CHAPTER 4
CREATE TABLE CIDADE (
    CDCIDADE INTEGER NOT NULL,
    SGESTADO CHAR(2) NOT NULL,
    NMCIDADE VARCHAR(20) NULL,
    PRIMARY KEY (CDCIDADE, SGESTADO),
    FOREIGN KEY (SGESTADO)
    REFERENCES ESTADO (SGESTADO)
);

-- EXERCISE 2 OF THE CHAPTER 5
INSERT INTO CIDADE (CDCIDADE, NMCIDADE, SGESTADO)
VALUES (1, 'SÃO PAULO', 'SP'),
(2, 'SANTO ANDRÉ', 'SP'),
(3, 'CAMPINAS', 'SP'),
(1, 'RIO DE JANEIRO', 'RJ'),
(2, 'NITERÓI', 'RJ');

-- EXERCISE 1 OF THE CHAPTER 4
CREATE TABLE BAIRRO (
    CDBAIRRO INTEGER NOT NULL,
    CDCIDADE INTEGER NOT NULL,
    SGESTADO CHAR(2) NOT NULL,
    NMBAIRRO VARCHAR(20) NULL,
    PRIMARY KEY (CDBAIRRO, CDCIDADE, SGESTADO),
    FOREIGN KEY (CDCIDADE)
    REFERENCES CIDADE (CDCIDADE),
    FOREIGN KEY (SGESTADO)
    REFERENCES ESTADO (SGESTADO)
);

-- EXERCISE 3 OF THE CHAPTER 5
INSERT INTO BAIRRO (CDBAIRRO, NMBAIRRO, CDCIDADE, SGESTADO)
VALUES(1, 'JARDINS', 1, 'SP'),
(2, 'MORUMBI', 1, 'SP'),
(3, 'AEROPORTO', 1, 'SP'),
(1, 'AEROPORTO', 1, 'RJ'),
(2, 'FLAMENGO', 1, 'RJ');

-- EXERCISE 1 OF THE CHAPTER 4
CREATE TABLE FAIXA_IMOVEL (
    CDFAIXA INTEGER NOT NULL,
    NMFAIXA VARCHAR(30) NULL,
    VLMINIMO DECIMAL(14,2) NULL,
    VLMAXIMO DECIMAL(14,2) NULL,
    PRIMARY KEY (CDFAIXA)
);

-- EXERCISE 15 OF THE CHAPTER 5
INSERT INTO FAIXA_IMOVEL(CDFAIXA, NMFAIXA, VLMINIMO, VLMAXIMO)
    VALUES(1, 'BAIXO', 0, 105000),
    (2, 'MÉDIO', 105001, 180000),
    (3, 'ALTO', 180001, 999999);

-- EXERCISE 1 OF THE CHAPTER 4
CREATE TABLE VENDEDOR(
    CDVENDEDOR  INTEGER NOT NULL,
    NMVENDEDOR  VARCHAR(40) NULL,
    NMENDERECO  VARCHAR(40) NULL,
    NRCPF DECIMAL(11) UNIQUE,
    NMCIDADE VARCHAR(20) NULL,
    NMBAIRRO VARCHAR(20) NULL,
    SGESTADO CHAR(2) NULL,
    TELEFONE VARCHAR(20) NULL,
    EMAIL VARCHAR(80) NULL,
    PRIMARY KEY (CDVENDEDOR)
);

-- EXERCISE 4 OF THE CHAPTER 5
INSERT INTO VENDEDOR (CDVENDEDOR, NMVENDEDOR, NMENDERECO, EMAIL)
    VALUES(1, 'MARIA DA SILVA', 'RUA DO GRITO, 45', 'msilva@novatec.com.br'),
    (2, 'MARCOS ANDRADE', 'AV. DA SAUDADE, 325', 'mandrade@novatec.com.br'),
    (3, 'ANDRE CARDOSO', 'AV. BRASIL, 401', 'acardoso@novatec.com.br'),
    (4, 'TATIANA SOUZA', 'RUA DO IMPERADOR, 778', 'tsouza@novatec.com.br');

-- EXERCISE 1 OF THE CHAPTER 4
CREATE TABLE COMPRADOR(
    CDCOMPRADOR INTEGER NOT NULL,
    NMCOMPRADOR VARCHAR(40) NULL,
    NMENDERECO VARCHAR(40) NULL,
    NRCPF DECIMAL(11) UNIQUE,
    NMCIDADE VARCHAR(20) NULL,
    NMBAIRRO VARCHAR(20) NULL,
    SGESTADO CHAR(2) NULL,
    TELEFONE VARCHAR(20) NULL,
    EMAIL VARCHAR(80) NULL,
    PRIMARY KEY (CDCOMPRADOR)
);

-- EXERCISE 6 OF THE CHAPTER 5
INSERT INTO COMPRADOR (CDCOMPRADOR, NMCOMPRADOR, NMENDERECO, EMAIL)
    VALUES(1, 'EMMANUEL ANTUNES', 'R SARAIVA, 452', 'eantunes@novatec.com.br'),
    (2, 'JOANA PEREIRA', 'AV PORTUGAL, 52', 'jpereira@novatec.com.br'),
    (3, 'RONALDO CAMPELO', 'R ESTADOS UNIDOS, 790', 'rcampelo@novatec.com.br'),
    (4, 'MANFRED AUGUSTO', 'AV BRASIL, 351', 'maugusto@novatec.com.br');

-- EXERCISE 1 OF THE CHAPTER 4
CREATE TABLE IMOVEL (
    CDIMOVEL INTEGER NOT NULL,
    CDVENDEDOR INTEGER NULL,
    CDBAIRRO INTEGER NULL,
    CDCIDADE INTEGER NULL,
    SGESTADO CHAR(2) NULL,
    NMENDERECO VARCHAR(40) NULL,
    NRAREAUTIL DECIMAL(10,2) NULL,
    NRAREATOTAL DECIMAL(10,2) NULL,
    DSIMOVEL VARCHAR(300) NULL,
    VLPRECO NUMERIC NULL,
    NROFERTAS INTEGER NULL,
    STVENDIDO CHAR(1) NULL,
    DTLANCTO DATE NULL,
    IMOVEL_INDICADO INTEGER NULL,
    PRIMARY KEY (CDIMOVEL),
    FOREIGN KEY (CDVENDEDOR)
    REFERENCES VENDEDOR (CDVENDEDOR),
    CONSTRAINT IMOVEL_IMOVEL
    FOREIGN KEY (IMOVEL_INDICADO)
    REFERENCES IMOVEL (CDIMOVEL),
    FOREIGN KEY (CDBAIRRO)
    REFERENCES BAIRRO (CDBAIRRO),
    FOREIGN KEY (CDCIDADE)
    REFERENCES CIDADE (CDCIDADE),
    FOREIGN KEY (SGESTADO)
    REFERENCES ESTADO (SGESTADO)
);

-- EXERCISE 5 OF THE CHAPTER 5
INSERT INTO IMOVEL (CDIMOVEL, CDVENDEDOR, CDBAIRRO, CDCIDADE, SGESTADO, NMENDERECO, NRAREAUTIL, NRAREATOTAL, VLPRECO, IMOVEL_INDICADO)
    VALUES(1, 1, 1, 1, 'SP', 'AL TIETE, 3304 AP 101', 250, 400, 180000, NULL),
    (2, 1, 2, 1, 'SP', 'AV MORUMBI, 2230', 150, 250, 135000, 1 ),
    (3, 2, 1, 1, 'RJ', 'R GAL OSORIO, 445 AP 34', 250, 400, 185000, 2),
    (4, 2, 2, 1, 'RJ', 'R D PEDRO I, 882', 120, 200, 110000, 1),
    (5, 3, 3, 1, 'SP', 'AV RUBEM BERTA, 2355', 110, 200, 95000, 4),
    (6, 4, 1, 1, 'RJ', 'R GETULIO VARGAS, 552', 200, 300, 99000, 5);

-- EXERCISE 1 OF THE CHAPTER 4
CREATE TABLE OFERTA (
    CDIMOVEL INTEGER NOT NULL,
    CDCOMPRADOR INTEGER NOT NULL,
    VLOFERTA INTEGER NULL,
    DTOFERTA DATE NULL,
    PRIMARY KEY (CDIMOVEL, CDCOMPRADOR),
    FOREIGN KEY (CDIMOVEL)
    REFERENCES IMOVEL (CDIMOVEL),
    FOREIGN KEY (CDCOMPRADOR)
    REFERENCES COMPRADOR (CDCOMPRADOR)
);

-- EXERCISE 7 OF THE CHAPTER 5
INSERT INTO OFERTA (CDCOMPRADOR, CDIMOVEL, VLOFERTA, DTOFERTA)
    VALUES (1, 1, 170000, '2002-01-10'),
    (1, 3, 180000, '2002-01-10'),
    (2, 2, 135000, '2002-02-15'),
    (2, 4, 100000, '2002-02-15'),
    (3, 1, 160000, '2002-01-05'),
    (3, 2, 140000, '2002-02-20');

-- EXERCISE 2 OF THE CHAPTER 4
CREATE INDEX NMVENDEDOR ON VENDEDOR
    (NMVENDEDOR);

CREATE INDEX NMCOMPRADOR ON COMPRADOR
    (CDCOMPRADOR);

-- EXERCISE 3 OF THE CHAPTER 4
CREATE INDEX OFERTAIMOVEL ON OFERTA
    (CDIMOVEL ASC);

CREATE INDEX OFERTAVL ON OFERTA
    (VLOFERTA DESC);